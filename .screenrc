# -*- mode: sh -*-

# This is how one can set a reattach password:
# password ODSJQf.4IJN7E    # "1234"

activity '^GActivity in window %'
bell_msg '^GBell in window %' # message for bell in bg window
vbell on
#vbellwait 1

# detach on hangup
autodetach on

# don't display the copyright page
startup_message off

# emulate .logout message
pow_detach_msg "Screen session of \$LOGNAME \$:cr:\$:nl:ended."

# Make shell "sticky" - bypass shell switching mechanism if it's in use
shell $SHELL

defscrollback 10000

# ANSI mostly works with older screens, until the status line hits
# the right-hand edge of the terminal.
#hardstatus alwayslastline "[0m%?[1;33m%-Lw[0m%?[44;37m%n*%f %t%?(%u)%?[0m%?[1;33m%+Lw%?[0m"
hardstatus alwayslastline "%{=}%?%{+b Y}%-Lw%{-}%?%{= BW}%n*%f %t%?(%u)%?%{-}%?%{+b Y}%+Lw%?%{-}"
# Really old screens don't have %-Lw and %+Lw
#hardstatus alwayslastline "[44;37m%w[0m"

# don't kill window after the process died
# zombie "^["

# C-a is too useful to rebind as a prefix.  This is actually two
# "characters", the first being ^\, and the second \\.
defescape ^\\\
escape ^\\\

# Default startup windows (-t <title>).
# Presumably if I'm using screen I want at least 2 windows.
screen
screen
#screen
# start with 0th window
select 0

# Imbeciles!!!!
msgwait 1
# might need this one too
msgminwait 1

# Bind delete to ^?.  kD is termcap-speak for delete (-k uses termcap-speak)
bindkey -k kD stuff "\177"

# Changing window title
bindkey -k k2 title # (F1 is used by Eterm)
bindkey -k k9 title

bindkey -k k3 multiuser off
bindkey -k k4 multiuser on
# NOTE: to do multiuser, you must have screen setuid root.
# grep screen(1) for 'owner'

# F1 is F11, believe it or not.
bindkey -k F1 colon

# S-left/S-right changes windows.  
bindkey "[c" next
bindkey "[d" prev

# For split regions
bind j focus down
bind k focus up

# Thanks Michael Schroeder for helping me get this working!
#
#termcapinfo xterm* "ks=\E[?1l\E=:ku=\E[A:kd=\E[B:kl=\E[D:kr=\E[C"
#
# Commented out, because as it turns out, ensuring TERM=Eterm
# will work nicer than the above hack.  Here's an 
# explanation of what it does anyway:
#
# \E[? is for DEC private modes.  1 is for Application/Normal
# cursor keys, and l does a DECRST.  \E= sets Application Keypad
# (\E> sets Normal Keypad).  Setting the ks capability to this
# ensures that Eterm never switches to application mode.  We
# want normal mode, since in normal mode, Eterm distinguishes
# between left and S-left:
#   http://www.eterm.org/docs/view.php?doc=ref#keys

# Insert pastes
bindkey    -k kI paste .

# S-down enters copy mode
bindkey "[b" copy

# Bindings using eval go last since they don't work on older screens
# and we want all other settings to always take effect.

# S-up enters copy mode and goes up a line
bindkey "[a" eval copy "stuff k"

# PageUp enters copy mode and goes up a page
bindkey -k kP eval copy "stuff ^U^Uj"

# Insert exits copy mode and pastes
bindkey -m -k kI eval 'stuff " "' "paste ."

# F9 allows quick reordering of windows
bindkey -k k9 eval colon 'stuff "number "'
